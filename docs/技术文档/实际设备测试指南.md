# 实际设备测试指南

本文档提供了设置和运行实际设备测试的详细步骤，主要针对TCP/Socket协议设备。

## 目录

1. [前提条件](#前提条件)
2. [设备准备](#设备准备)
3. [配置设备](#配置设备)
4. [运行测试](#运行测试)
5. [分析结果](#分析结果)
6. [常见问题](#常见问题)

## 前提条件

在开始测试前，请确保您已经：

- 安装了Node.js（版本 >= 14.0.0）
- 安装了TypeScript（`npm install -g typescript`）
- 安装了ts-node（`npm install -g ts-node`）
- 具有管理员权限，能够配置网络设置
- 了解被测设备的TCP/IP协议规范

## 设备准备

1. 确保所有测试设备已接通电源
2. 将设备连接到与测试计算机相同的局域网
3. 记录每个设备的IP地址和端口号
4. 确认设备已正确配置且处于就绪状态
5. 如有必要，请咨询设备制造商获取详细的通信规范

## 配置设备

测试配置文件位于 `config/devices/actual-devices.json`。请按照以下格式为每个设备添加配置：

```json
{
  "id": "设备唯一标识符",
  "name": "设备名称",
  "ip": "设备IP地址",
  "port": 设备端口号,
  "protocol": "tcp",
  "timeout": 超时时间(毫秒),
  "commandSet": {
    "init": "初始化命令(十六进制)",
    "getData": "获取数据命令(十六进制)",
    "control": "控制命令(十六进制)",
    "reset": "重置命令(十六进制)",
    "status": "状态查询命令(十六进制)"
  }
}
```

### 命令格式说明

所有命令都应以十六进制字符串格式提供，不含空格或其他分隔符。例如：

- 初始化命令：`"AA5504010000FF"`
- 获取数据命令：`"AA5501020000FF"`

根据设备协议规范调整这些命令。

## 运行测试

有三种方式运行测试：

### 方法1：使用批处理文件（推荐）

直接双击项目根目录下的 `run-tcp-device-test-v3.bat` 文件。

### 方法2：使用PowerShell脚本

1. 打开PowerShell
2. 导航到项目根目录
3. 执行：`.\scripts\run-tcp-device-test-v3.ps1`
### 方法3：直接使用ts-node

1. 打开命令提示符或PowerShell
2. 导航到项目根目录
3. 执行：`npx ts-node scripts/tcp-device-integration-test-v3.ts`

## 分析结果

测试完成后，结果会保存在 `tests/reports` 目录下，文件名格式为 `tcp-device-test-[时间戳].json`。

结果文件包含以下信息：

- 连接状态
- 数据交换成功与否
- 响应时间
- 原始响应数据
- 解析后的数据（如适用）
- 错误信息（如有）

同时，控制台也会显示测试摘要，包括成功率和平均响应时间等指标。

## 常见问题

### 设备连接超时

**可能原因**：
- 设备IP地址或端口配置错误
- 设备未开机或网络连接问题
- 防火墙阻止了连接

**解决方案**：
- 验证IP地址和端口配置
- 使用ping测试网络连通性
- 临时关闭防火墙或添加例外规则

### 数据解析错误

**可能原因**：
- 命令格式不正确
- 设备返回的数据格式与预期不符
- 数据包不完整

**解决方案**：
- 检查命令格式是否符合设备规范
- 查看原始响应数据，调整解析逻辑
- 调整超时时间，确保接收完整数据
### 设备无响应

**可能原因**：
- 设备处于休眠或节能模式
- 设备固件问题
- 命令格式不正确

**解决方案**：
- 重启设备
- 更新设备固件
- 检查命令格式

## 联系支持

如遇到其他问题，请联系技术支持团队：

- 邮箱：support@ailab.example.com
- 电话：400-123-4567

---

文档最后更新：2025年7月22日

如有任何问题，请联系技术支持团队。
