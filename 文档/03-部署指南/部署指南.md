# 此文件是 [documentation\03-deployment\deployment-guide.md] 的中文链接

> 注意：此文件是为了满足文档命名标准化的需要而创建的链接文件。原始内容在英文命名的文件中。

---

# 浜哄伐鏅鸿兘瀹為獙骞冲彴閮ㄧ讲杩愮淮鎸囧崡

## 馃搵 閮ㄧ讲姒傝堪

鏈枃妗ｈ缁嗕粙缁嶄簡浜哄伐鏅鸿兘瀹為獙骞冲彴鐨勯儴缃叉祦绋嬶紝鍖呮嫭寮€鍙戠幆澧冦€佹祴璇曠幆澧冨拰鐢熶骇鐜鐨勯儴缃叉柟娉曘€?

## 馃殌 寮€鍙戠幆澧冨揩閫熷惎鍔?

### Windows寮€鍙戠幆澧?(褰撳墠鎺ㄨ崘鏂瑰紡)

#### 鏂规硶1: 鏍囧噯鍚姩鑴氭湰 鉁?
```powershell
# 椤圭洰鏍圭洰褰? D:\AICAMV2

# 鍚姩鍓嶅悗绔湇鍔?
powershell -ExecutionPolicy Bypass -File "D:\AICAMV2\鏍囧噯鍚姩鑴氭湰.ps1"

# 鍒嗗埆鍚姩鏈嶅姟
powershell -ExecutionPolicy Bypass -File "D:\AICAMV2\鏍囧噯鍚姩鑴氭湰.ps1" -Frontend  # 浠呭墠绔?
powershell -ExecutionPolicy Bypass -File "D:\AICAMV2\鏍囧噯鍚姩鑴氭湰.ps1" -Backend   # 浠呭悗绔?

# 鍋滄鎵€鏈夋湇鍔?
powershell -ExecutionPolicy Bypass -File "D:\AICAMV2\鏍囧噯鍚姩鑴氭湰.ps1" -Stop
```

#### 鏂规硶2: 鎵嬪姩鍚姩 鉁?
```powershell
# 鍚庣鏈嶅姟 (绔彛: 3002)
Set-Location "D:\AICAMV2\backend"
node "D:\AICAMV2\backend\simple-start.js"

# 鍓嶇鏈嶅姟 (绔彛: 3000) - 鏂扮粓绔?
Set-Location "D:\AICAMV2\frontend"
node "D:\AICAMV2\frontend\node_modules\react-scripts\bin\react-scripts.js" start
```

#### 鏈嶅姟楠岃瘉
- **鍓嶇搴旂敤**: http://localhost:3000
- **鍚庣鍋ュ悍妫€鏌?*: http://localhost:3002/api/health  
- **鍚庣鏁版嵁鎺ュ彛**: http://localhost:3002/api/dashboard/stats

### 寮€鍙戠幆澧冭鏄?
- **鏁版嵁搴?*: 寮€鍙戞ā寮忎娇鐢∕ock鏁版嵁锛屾棤闇€閰嶇疆MongoDB
- **瀹炴椂閫氫俊**: WebSocket鑷姩鍚敤
- **鐑噸杞?*: 鍓嶇浠ｇ爜淇敼鑷姩鍒锋柊

## 鐜瑕佹眰

### 纭欢瑕佹眰

#### 鏈€灏忛厤缃?
- **CPU**: 4鏍稿績 2.0GHz
- **鍐呭瓨**: 8GB RAM
- **瀛樺偍**: 100GB SSD
- **缃戠粶**: 100Mbps

#### 鎺ㄨ崘閰嶇疆
- **CPU**: 8鏍稿績 3.0GHz
- **鍐呭瓨**: 16GB RAM
- **瀛樺偍**: 500GB SSD
- **缃戠粶**: 1Gbps

### 杞欢瑕佹眰

- **鎿嶄綔绯荤粺**: Ubuntu 20.04 LTS 鎴?CentOS 8
- **Docker**: 20.10 鎴栨洿楂樼増鏈?
- **Docker Compose**: 2.0 鎴栨洿楂樼増鏈?
- **Git**: 2.30 鎴栨洿楂樼増鏈?

## 閮ㄧ讲鏂瑰紡

### 1. Docker Compose 閮ㄧ讲锛堟帹鑽愶級

#### 1.1 鍑嗗鐜

```bash
# 鏇存柊绯荤粺
sudo apt update && sudo apt upgrade -y

# 瀹夎Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# 瀹夎Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# 灏嗗綋鍓嶇敤鎴锋坊鍔犲埌docker缁?
sudo usermod -aG docker $USER
```

#### 1.2 鍏嬮殕椤圭洰

```bash
git clone https://github.com/your-username/AIExperimentPlatform.git
cd AIExperimentPlatform
```

#### 1.3 閰嶇疆鐜鍙橀噺

```bash
# 澶嶅埗鐜閰嶇疆鏂囦欢
cp env.example .env

# 缂栬緫閰嶇疆鏂囦欢
nano .env
```

**閲嶈閰嶇疆椤?*:
```bash
# 鏁版嵁搴撻厤缃?
MONGODB_URI=mongodb://mongodb:27017/aicam
POSTGRES_URL=postgresql://postgres:password@postgres:5432/aicam
REDIS_URL=redis://redis:6379

# JWT瀵嗛挜锛堢敓浜х幆澧冨繀椤讳慨鏀癸級
JWT_SECRET=your-super-secret-jwt-key-change-in-production

# AI鏈嶅姟閰嶇疆
OPENAI_API_KEY=your-openai-api-key

# 鍩熷悕閰嶇疆锛堢敓浜х幆澧冿級
FRONTEND_URL=https://your-domain.com
```

#### 1.4 鍚姩鏈嶅姟

```bash
# 鏋勫缓骞跺惎鍔ㄦ墍鏈夋湇鍔?
docker-compose up -d

# 鏌ョ湅鏈嶅姟鐘舵€?
docker-compose ps

# 鏌ョ湅鏃ュ織
docker-compose logs -f
```

#### 1.5 鍒濆鍖栨暟鎹簱

```bash
# 杩愯鏁版嵁搴撹縼绉?
docker-compose exec backend npm run migrate

# 鍒濆鍖栫瀛愭暟鎹?
docker-compose exec backend npm run seed
```

### 2. 鎵嬪姩閮ㄧ讲

#### 2.1 瀹夎Node.js

```bash
# 瀹夎Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# 楠岃瘉瀹夎
node --version
npm --version
```

#### 2.2 瀹夎Python

```bash
# 瀹夎Python 3.9
sudo apt install python3.9 python3.9-pip python3.9-venv

# 鍒涘缓铏氭嫙鐜
python3.9 -m venv aicam-env
source aicam-env/bin/activate
```

#### 2.3 瀹夎鏁版嵁搴?

```bash
# 瀹夎MongoDB
wget -qO - https://www.mongodb.org/static/pgp/server-6.0.asc | sudo apt-key add -
echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/6.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-6.0.list
sudo apt update
sudo apt install -y mongodb-org

# 鍚姩MongoDB
sudo systemctl start mongod
sudo systemctl enable mongod

# 瀹夎PostgreSQL
sudo apt install postgresql postgresql-contrib

# 閰嶇疆PostgreSQL
sudo -u postgres psql
CREATE DATABASE aicam;
CREATE USER aicam_user WITH PASSWORD 'password';
GRANT ALL PRIVILEGES ON DATABASE aicam TO aicam_user;
\q

# 瀹夎Redis
sudo apt install redis-server
sudo systemctl start redis-server
sudo systemctl enable redis-server
```

#### 2.4 閮ㄧ讲搴旂敤

```bash
# 瀹夎鍓嶇渚濊禆
cd frontend
npm install
npm run build

# 瀹夎鍚庣渚濊禆
cd ../backend
npm install
npm run build

# 瀹夎AI鏈嶅姟渚濊禆
cd ../ai
pip install -r requirements.txt
```

#### 2.5 鍚姩鏈嶅姟

```bash
# 鍚姩鍚庣鏈嶅姟
cd backend
npm start

# 鍚姩AI鏈嶅姟
cd ../ai
python main.py

# 鍚姩鍓嶇鏈嶅姟锛堢敓浜х幆澧冧娇鐢∟ginx锛?
cd ../frontend
npm start
```

## 鐢熶骇鐜閮ㄧ讲

### 1. 浣跨敤Nginx鍙嶅悜浠ｇ悊

#### 1.1 瀹夎Nginx

```bash
sudo apt install nginx
```

#### 1.2 閰嶇疆Nginx

鍒涘缓閰嶇疆鏂囦欢 `/etc/nginx/sites-available/aicam`:

```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    # 閲嶅畾鍚戝埌HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;
    
    # SSL璇佷功閰嶇疆
    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;
    
    # SSL閰嶇疆
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    
    # 鍓嶇闈欐€佹枃浠?
    location / {
        root /var/www/aicam/frontend/build;
        try_files $uri $uri/ /index.html;
        
        # 缂撳瓨閰嶇疆
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
    
    # API浠ｇ悊
    location /api/ {
        proxy_pass http://localhost:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
    
    # AI鏈嶅姟浠ｇ悊
    location /ai/ {
        proxy_pass http://localhost:8001;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # WebSocket浠ｇ悊
    location /socket.io/ {
        proxy_pass http://localhost:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

#### 1.3 鍚敤閰嶇疆

```bash
# 鍒涘缓绗﹀彿閾炬帴
sudo ln -s /etc/nginx/sites-available/aicam /etc/nginx/sites-enabled/

# 娴嬭瘯閰嶇疆
sudo nginx -t

# 閲嶅惎Nginx
sudo systemctl restart nginx
```

### 2. SSL璇佷功閰嶇疆

#### 2.1 浣跨敤Let's Encrypt

```bash
# 瀹夎Certbot
sudo apt install certbot python3-certbot-nginx

# 鑾峰彇SSL璇佷功
sudo certbot --nginx -d your-domain.com

# 璁剧疆鑷姩缁湡
sudo crontab -e
# 娣诲姞浠ヤ笅琛?
0 12 * * * /usr/bin/certbot renew --quiet
```

### 3. 浣跨敤PM2绠＄悊杩涚▼

#### 3.1 瀹夎PM2

```bash
npm install -g pm2
```

#### 3.2 鍒涘缓PM2閰嶇疆鏂囦欢

鍒涘缓 `ecosystem.config.js`:

```javascript
module.exports = {
  apps: [
    {
      name: 'aicam-backend',
      script: './backend/dist/index.js',
      instances: 'max',
      exec_mode: 'cluster',
      env: {
        NODE_ENV: 'production',
        PORT: 8000
      },
      error_file: './logs/backend-error.log',
      out_file: './logs/backend-out.log',
      log_file: './logs/backend-combined.log',
      time: true
    },
    {
      name: 'aicam-ai',
      script: './ai/main.py',
      interpreter: 'python3',
      instances: 1,
      env: {
        PYTHONPATH: './ai'
      },
      error_file: './logs/ai-error.log',
      out_file: './logs/ai-out.log',
      log_file: './logs/ai-combined.log',
      time: true
    }
  ]
};
```

#### 3.3 鍚姩鏈嶅姟

```bash
# 鍚姩鎵€鏈夋湇鍔?
pm2 start ecosystem.config.js

# 淇濆瓨PM2閰嶇疆
pm2 save

# 璁剧疆寮€鏈鸿嚜鍚?
pm2 startup
```

## 鐩戞帶鍜屾棩蹇?

### 1. 鏃ュ織閰嶇疆

#### 1.1 鍒涘缓鏃ュ織鐩綍

```bash
mkdir -p logs
chmod 755 logs
```

#### 1.2 閰嶇疆鏃ュ織杞浆

鍒涘缓 `/etc/logrotate.d/aicam`:

```
/var/www/aicam/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 www-data www-data
    postrotate
        pm2 reloadLogs
    endscript
}
```

### 2. 鐩戞帶閰嶇疆

#### 2.1 浣跨敤Prometheus鍜孏rafana

```bash
# 鍚姩鐩戞帶鏈嶅姟
docker-compose -f docker-compose.monitoring.yml up -d
```

#### 2.2 閰嶇疆鍛婅

鍒涘缓鍛婅瑙勫垯鏂囦欢 `monitoring/alerts.yml`:

```yaml
groups:
  - name: aicam_alerts
    rules:
      - alert: HighCPUUsage
        expr: cpu_usage > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "CPU浣跨敤鐜囪繃楂?
          description: "CPU浣跨敤鐜囪秴杩?0%鎸佺画5鍒嗛挓"

      - alert: HighMemoryUsage
        expr: memory_usage > 85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "鍐呭瓨浣跨敤鐜囪繃楂?
          description: "鍐呭瓨浣跨敤鐜囪秴杩?5%鎸佺画5鍒嗛挓"

      - alert: ServiceDown
        expr: up == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "鏈嶅姟涓嶅彲鐢?
          description: "鏈嶅姟 {{ $labels.instance }} 涓嶅彲鐢?
```

## 澶囦唤鍜屾仮澶?

### 1. 鏁版嵁搴撳浠?

#### 1.1 MongoDB澶囦唤

```bash
# 鍒涘缓澶囦唤鑴氭湰
cat > backup-mongo.sh << 'EOF'
#!/bin/bash
BACKUP_DIR="/backup/mongodb"
DATE=$(date +%Y%m%d_%H%M%S)
mkdir -p $BACKUP_DIR

# 澶囦唤MongoDB
docker-compose exec -T mongodb mongodump --out /dump
docker cp aicam_mongodb_1:/dump $BACKUP_DIR/mongo_$DATE

# 鍘嬬缉澶囦唤
tar -czf $BACKUP_DIR/mongo_$DATE.tar.gz -C $BACKUP_DIR mongo_$DATE
rm -rf $BACKUP_DIR/mongo_$DATE

# 鍒犻櫎7澶╁墠鐨勫浠?
find $BACKUP_DIR -name "mongo_*.tar.gz" -mtime +7 -delete
EOF

chmod +x backup-mongo.sh

# 娣诲姞鍒板畾鏃朵换鍔?
crontab -e
# 娣诲姞浠ヤ笅琛岋紙姣忓ぉ鍑屾櫒2鐐瑰浠斤級
0 2 * * * /path/to/backup-mongo.sh
```

#### 1.2 PostgreSQL澶囦唤

```bash
# 鍒涘缓澶囦唤鑴氭湰
cat > backup-postgres.sh << 'EOF'
#!/bin/bash
BACKUP_DIR="/backup/postgres"
DATE=$(date +%Y%m%d_%H%M%S)
mkdir -p $BACKUP_DIR

# 澶囦唤PostgreSQL
docker-compose exec -T postgres pg_dump -U postgres aicam > $BACKUP_DIR/postgres_$DATE.sql

# 鍘嬬缉澶囦唤
gzip $BACKUP_DIR/postgres_$DATE.sql

# 鍒犻櫎7澶╁墠鐨勫浠?
find $BACKUP_DIR -name "postgres_*.sql.gz" -mtime +7 -delete
EOF

chmod +x backup-postgres.sh
```

### 2. 鏂囦欢澶囦唤

```bash
# 澶囦唤涓婁紶鏂囦欢
tar -czf /backup/uploads_$(date +%Y%m%d_%H%M%S).tar.gz uploads/

# 澶囦唤閰嶇疆鏂囦欢
tar -czf /backup/config_$(date +%Y%m%d_%H%M%S).tar.gz .env ecosystem.config.js
```

## 瀹夊叏閰嶇疆

### 1. 闃茬伀澧欓厤缃?

```bash
# 瀹夎UFW
sudo apt install ufw

# 閰嶇疆闃茬伀澧欒鍒?
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 22/tcp

# 鍚敤闃茬伀澧?
sudo ufw enable
```

### 2. 绯荤粺瀹夊叏

```bash
# 鏇存柊绯荤粺
sudo apt update && sudo apt upgrade -y

# 瀹夎瀹夊叏宸ュ叿
sudo apt install fail2ban

# 閰嶇疆fail2ban
sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
sudo systemctl enable fail2ban
sudo systemctl start fail2ban
```

### 3. 鏁版嵁搴撳畨鍏?

```bash
# MongoDB瀹夊叏閰嶇疆
sudo nano /etc/mongod.conf

# 娣诲姞浠ヤ笅閰嶇疆
security:
  authorization: enabled

# 鍒涘缓绠＄悊鍛樼敤鎴?
mongo
use admin
db.createUser({
  user: "admin",
  pwd: "secure_password",
  roles: ["userAdminAnyDatabase", "dbAdminAnyDatabase", "readWriteAnyDatabase"]
})

# PostgreSQL瀹夊叏閰嶇疆
sudo nano /etc/postgresql/13/main/postgresql.conf
# 淇敼浠ヤ笅閰嶇疆
listen_addresses = 'localhost'
max_connections = 100
```

## 鎬ц兘浼樺寲

### 1. 鏁版嵁搴撲紭鍖?

#### 1.1 MongoDB浼樺寲

```javascript
// 鍒涘缓绱㈠紩
db.devices.createIndex({ "status": 1 })
db.sensors.createIndex({ "deviceId": 1, "timestamp": -1 })
db.analysis.createIndex({ "deviceId": 1, "createdAt": -1 })

// 閰嶇疆MongoDB
sudo nano /etc/mongod.conf
# 娣诲姞浠ヤ笅閰嶇疆
storage:
  wiredTiger:
    engineConfig:
      cacheSizeGB: 2
    collectionConfig:
      blockCompressor: snappy
```

#### 1.2 PostgreSQL浼樺寲

```sql
-- 鍒涘缓绱㈠紩
CREATE INDEX idx_devices_status ON devices(status);
CREATE INDEX idx_sensors_device_timestamp ON sensors(device_id, timestamp);

-- 閰嶇疆PostgreSQL
sudo nano /etc/postgresql/13/main/postgresql.conf
# 淇敼浠ヤ笅閰嶇疆
shared_buffers = 256MB
effective_cache_size = 1GB
work_mem = 4MB
maintenance_work_mem = 64MB
```

### 2. 搴旂敤浼樺寲

#### 2.1 Node.js浼樺寲

```bash
# 璁剧疆Node.js鐜鍙橀噺
export NODE_ENV=production
export NODE_OPTIONS="--max-old-space-size=4096"

# 浣跨敤PM2闆嗙兢妯″紡
pm2 start ecosystem.config.js --instances max
```

#### 2.2 Redis浼樺寲

```bash
# 閰嶇疆Redis
sudo nano /etc/redis/redis.conf
# 淇敼浠ヤ笅閰嶇疆
maxmemory 512mb
maxmemory-policy allkeys-lru
save 900 1
save 300 10
save 60 10000
```

## 鏁呴殰鎺掗櫎

### 1. 甯歌闂

#### 1.1 鏈嶅姟鏃犳硶鍚姩

```bash
# 妫€鏌ョ鍙ｅ崰鐢?
sudo netstat -tulpn | grep :8000

# 妫€鏌ユ棩蹇?
docker-compose logs backend
pm2 logs aicam-backend

# 妫€鏌ラ厤缃枃浠?
docker-compose config
```

#### 1.2 鏁版嵁搴撹繛鎺ュけ璐?

```bash
# 妫€鏌ユ暟鎹簱鏈嶅姟鐘舵€?
sudo systemctl status mongod
sudo systemctl status postgresql
sudo systemctl status redis-server

# 娴嬭瘯鏁版嵁搴撹繛鎺?
mongo --eval "db.runCommand('ping')"
psql -U postgres -d aicam -c "SELECT 1;"
redis-cli ping
```

#### 1.3 鍐呭瓨涓嶈冻

```bash
# 妫€鏌ュ唴瀛樹娇鐢?
free -h
htop

# 浼樺寲鍐呭瓨浣跨敤
# 1. 鍑忓皯Docker瀹瑰櫒鍐呭瓨闄愬埗
# 2. 璋冩暣Node.js鍐呭瓨闄愬埗
# 3. 浼樺寲鏁版嵁搴撶紦瀛橀厤缃?
```

### 2. 鎬ц兘鐩戞帶

```bash
# 鐩戞帶绯荤粺璧勬簮
htop
iotop
nethogs

# 鐩戞帶搴旂敤鎬ц兘
pm2 monit
docker stats

# 鐩戞帶缃戠粶杩炴帴
ss -tulpn
netstat -i
```

## 鏇存柊鍜屽崌绾?

### 1. 搴旂敤鏇存柊

```bash
# 鎷夊彇鏈€鏂颁唬鐮?
git pull origin main

# 閲嶆柊鏋勫缓闀滃儚
docker-compose build

# 閲嶅惎鏈嶅姟
docker-compose down
docker-compose up -d

# 杩愯鏁版嵁搴撹縼绉?
docker-compose exec backend npm run migrate
```

### 2. 绯荤粺鍗囩骇

```bash
# 鏇存柊绯荤粺鍖?
sudo apt update && sudo apt upgrade -y

# 鏇存柊Docker
sudo apt install docker-ce docker-ce-cli containerd.io

# 鏇存柊Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/latest/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

## 鑱旂郴鏀寔

濡傛灉鍦ㄩ儴缃茶繃绋嬩腑閬囧埌闂锛岃鑱旂郴锛?

- **鎶€鏈敮鎸?*: support@aicam.com
- **鏂囨。**: https://docs.aicam.com
- **GitHub Issues**: https://github.com/aicam/issues
- **绀惧尯璁哄潧**: https://community.aicam.com 
