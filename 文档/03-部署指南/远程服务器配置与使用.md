# 远程服务器配置与使用指南

## 服务器要求

### 硬件要求
- **CPU**: 最低2核，推荐4核及以上
- **内存**: 最低4GB，推荐8GB及以上
- **存储**: 最低20GB可用空间，推荐SSD
- **网络**: 宽带互联网连接，推荐固定IP

### 软件要求
- **操作系统**: Ubuntu 20.04 LTS或以上，CentOS 7或以上
- **Node.js**: v16.x或以上
- **npm**: v8.x或以上
- **Python**: 3.8或以上
- **SSH服务**: OpenSSH Server

## 初始服务器配置

### 1. 安装必要的依赖

```bash
# 更新系统
sudo apt update
sudo apt upgrade -y

# 安装Node.js和npm
curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash -
sudo apt install -y nodejs

# 安装Python及依赖
sudo apt install -y python3 python3-pip python3-venv
sudo apt install -y build-essential libssl-dev libffi-dev python3-dev

# 安装其他工具
sudo apt install -y git curl wget unzip
```

### 2. 创建AICAM用户和目录

```bash
# 创建用户
sudo adduser aicam
sudo usermod -aG sudo aicam

# 创建项目目录
sudo mkdir -p /home/aicam/aicam-platform
sudo chown -R aicam:aicam /home/aicam/aicam-platform
```

### 3. 配置SSH密钥认证（可选但推荐）

在本地生成SSH密钥（如果没有）：
```bash
ssh-keygen -t rsa -b 4096
```

将公钥复制到远程服务器：
```bash
ssh-copy-id aicam@<服务器IP>
```

## 远程操作工具使用指南

AICAM平台提供了一系列工具简化远程服务器操作。所有工具都位于`scripts`目录下。

### 1. 测试连接

在部署前，先测试与远程服务器的连接：

```powershell
# 测试默认连接
.\scripts\test-remote-connection.ps1

# 自定义连接参数
.\scripts\test-remote-connection.ps1 --host <服务器IP> --user aicam --port 22
```

### 2. 文件同步

将本地项目文件同步到远程服务器：

```powershell
# 同步整个项目
.\scripts\sync-linux-incremental.bat --host <服务器IP> --user aicam

# 选择性同步
.\scripts\sync-linux-incremental.bat --host <服务器IP> --user aicam --mode frontend
.\scripts\sync-linux-incremental.bat --host <服务器IP> --user aicam --mode backend
.\scripts\sync-linux-incremental.bat --host <服务器IP> --user aicam --mode ai
```

### 3. 服务管理

启动和停止远程服务：

```powershell
# 启动服务
.\scripts\start-remote-server.ps1 --host <服务器IP> --user aicam

# 停止服务
.\scripts\stop-remote-server.ps1 --host <服务器IP> --user aicam
```

### 4. 一键部署和启动

一次性完成同步和启动操作：

```powershell
.\scripts\remote-deploy-start.bat --host <服务器IP> --user aicam
```

## 远程服务管理

### 服务访问

服务启动后，可通过以下URL访问：
- 前端: http://<服务器IP>:3000
- 后端: http://<服务器IP>:3002
- AI服务: http://<服务器IP>:5000

### 日志查看

远程服务的日志位于以下位置：
```bash
/home/aicam/aicam-platform/logs/frontend.log
/home/aicam/aicam-platform/logs/backend.log
/home/aicam/aicam-platform/logs/ai.log
```

可以使用以下命令查看日志：
```bash
# 实时查看前端日志
ssh aicam@<服务器IP> "tail -f /home/aicam/aicam-platform/logs/frontend.log"
```

### 服务更新

当需要更新远程服务时，建议按以下步骤操作：

1. 停止远程服务：`.\scripts\stop-remote-server.ps1 --host <服务器IP> --user aicam`
2. 同步更新的文件：`.\scripts\sync-linux-incremental.bat --host <服务器IP> --user aicam`
3. 重新启动服务：`.\scripts\start-remote-server.ps1 --host <服务器IP> --user aicam`

## 故障排除

### 连接问题
- 确认服务器IP地址和SSH端口正确
- 检查SSH密钥权限（应为600）
- 确认服务器防火墙已开放SSH端口

### 服务启动失败
- 检查日志文件获取详细错误信息
- 确认服务器上已安装所有依赖
- 验证环境变量配置正确

### 性能问题
- 检查服务器资源使用情况：`top`、`htop`
- 检查磁盘空间：`df -h`
- 监控内存使用：`free -m`
