# 人工智能辅助实验平台开发规范与操作指南 - 2025年6月26日更新

## 🚀 正确的项目启动方式

### ⚡ 标准启动流程 (必须遵循)

#### 方法1: 使用标准启动脚本 ✅ 推荐
```powershell
# 项目根目录: D:\AICAMV2

# 启动前后端服务
powershell -ExecutionPolicy Bypass -File "D:\AICAMV2\标准启动脚本.ps1"

# 分别启动
powershell -ExecutionPolicy Bypass -File "D:\AICAMV2\标准启动脚本.ps1" -Frontend  # 仅前端
powershell -ExecutionPolicy Bypass -File "D:\AICAMV2\标准启动脚本.ps1" -Backend   # 仅后端

# 停止服务
powershell -ExecutionPolicy Bypass -File "D:\AICAMV2\标准启动脚本.ps1" -Stop
```

#### 方法2: 手动绝对路径启动 ✅ 备用
```powershell
# 后端 (端口: 3002)
Set-Location "D:\AICAMV2\backend"
node "D:\AICAMV2\backend\simple-start.js"

# 前端 (端口: 3000) - 新终端
Set-Location "D:\AICAMV2\frontend"
node "D:\AICAMV2\frontend\node_modules\react-scripts\bin\react-scripts.js" start
```

#### ⚠️ 重要规范
1. **必须使用绝对路径** - 避免路径错误
2. **禁止相对路径** - 如 `cd frontend && npm start`
3. **单终端原则** - 避免开启多个无用终端
4. **验证启动** - 检查 http://localhost:3000 和 http://localhost:3002/api/health

## 📋 开发规范总则

### 1. 任务执行规范 🎯

**所有开发操作必须通过VS Code任务系统执行，禁止直接在终端手动输入命令**

#### 基本原则：
1. **统一任务管理**：所有命令必须预先在`.vscode/tasks.json`中定义
2. **目录分离**：前端任务在`${workspaceFolder}/frontend`执行，后端任务在`${workspaceFolder}/backend`执行
3. **终端检查**：执行任务前必须检查对应终端是否空闲
4. **参数模板**：需要参数的命令必须预先定义参数模板
5. **错误处理**：任务失败时必须通过任务系统重试，不得手动修复

#### 任务分类与命名规范：
- **前端任务**：`前端:任务名称`（在frontend目录执行）
- **后端任务**：`后端:任务名称`（在backend目录执行）
- **全栈任务**：`全栈:任务名称`（协调前后端）
- **测试任务**：`测试:任务名称`（测试相关）
- **运维任务**：`运维:任务名称`（部署运维）
- **质量任务**：`质量:任务名称`（代码质量）

### 2. 开发流程规范 🔄

#### 2.1 日常开发流程
```
1. 执行 [全栈:启动所有服务] 启动开发环境
2. 编写代码
3. 执行 [前端:类型检查] 或 [后端:类型检查] 验证类型
4. 执行 [质量:ESLint检查修复] 检查代码规范
5. 执行 [前端:运行测试] 或 [后端:运行测试] 验证功能
6. 执行 [全栈:构建所有项目] 确保构建成功
7. 提交代码
```

#### 2.2 问题修复流程
```
1. 发现问题 → 执行 [运维:停止所有服务] 停止服务
2. 代码修复 → 执行相应的类型检查任务
3. 本地测试 → 执行相应的测试任务
4. 构建验证 → 执行相应的构建任务
5. 重新启动 → 执行 [全栈:启动所有服务]
```

#### 2.3 部署发布流程
```
1. 执行 [全栈:类型检查] 确保类型安全
2. 执行 [测试:运行所有测试] 确保功能正常
3. 执行 [全栈:构建所有项目] 确保构建成功
4. 执行 [运维:Docker构建] 构建容器镜像
5. 执行 [运维:Docker启动] 启动生产环境
```

### 3. 终端管理规范 🖥️

#### 3.1 终端分配策略
- **前端开发**：使用专用面板（dedicated panel）
- **后端开发**：使用专用面板（dedicated panel）
- **全栈任务**：使用共享面板（shared panel）
- **测试任务**：使用专用面板（dedicated panel）
- **运维任务**：使用专用面板（dedicated panel）

#### 3.2 终端状态检查
执行新任务前必须确认：
1. **目标终端当前没有运行其他命令**
2. **相关服务没有占用端口**
3. **前一个任务已经完成或正确终止**

#### 3.3 冲突处理
- 如果发现终端被占用，执行 `[运维:停止所有服务]` 清理环境
- 如果端口被占用，检查进程并通过系统任务停止
- 如果任务失败，查看任务输出并通过相应修复任务解决

### 4. 代码质量规范 ✨

#### 4.1 类型安全要求
- **TypeScript覆盖率**：必须达到99%以上
- **类型检查**：每次代码变更后必须执行类型检查任务
- **编译错误**：不允许存在任何编译错误
- **类型导入**：优先使用`import type`导入类型

#### 4.2 代码规范要求
- **ESLint检查**：所有代码必须通过ESLint检查
- **格式化**：使用Prettier统一代码格式
- **命名规范**：组件、文件、变量采用标准化命名
- **注释规范**：关键逻辑必须添加清晰注释

#### 4.3 测试覆盖要求
- **单元测试**：核心组件必须有对应测试文件
- **集成测试**：关键功能必须有集成测试
- **测试运行**：每次代码变更后必须运行相关测试
- **测试通过率**：所有测试必须100%通过

### 5. 任务执行示例 💡

#### 5.1 启动开发环境
```
任务：[全栈:启动所有服务]
用途：同时启动前端和后端开发服务器
注意：确保端口3001(前端)和3002(后端)未被占用
```

#### 5.2 代码类型检查
```
任务：[前端:类型检查] 或 [后端:类型检查]
用途：检查TypeScript类型错误
注意：修复所有类型错误后才能进行后续操作
```

#### 5.3 构建项目
```
任务：[前端:构建项目] 或 [后端:构建项目]
用途：构建生产版本，检查构建是否成功
注意：构建失败必须修复所有错误
```

#### 5.4 运行测试
```
任务：[前端:运行测试] 或 [测试:运行所有测试]
用途：执行单元测试和集成测试
注意：所有测试必须通过才能提交代码
```

#### 5.5 代码质量检查
```
任务：[质量:ESLint检查修复]
用途：检查并自动修复代码规范问题
注意：手动修复无法自动修复的问题
```

### 6. 常见问题处理 🔧

#### 6.1 端口占用问题
```
问题：EADDRINUSE错误
解决：执行 [运维:停止所有服务] 清理环境
验证：重新执行启动任务
```

#### 6.2 类型错误问题
```
问题：TypeScript编译错误
解决：执行 [前端:类型检查] 查看具体错误
修复：根据错误提示修复类型定义
验证：重新执行类型检查任务确认修复
```

#### 6.3 依赖安装问题
```
问题：模块未找到错误
解决：执行 [前端:安装依赖] 或 [后端:安装依赖]
验证：重新执行相关任务确认问题解决
```

#### 6.4 构建失败问题
```
问题：构建过程中出现错误
解决：先执行类型检查，再执行ESLint检查
修复：解决所有类型和规范问题
验证：重新执行构建任务
```

### 7. 任务快速参考 📖

#### 7.1 前端任务列表
- `前端:启动开发服务器` - 启动前端开发服务器
- `前端:构建项目` - 构建前端生产版本
- `前端:类型检查` - 检查TypeScript类型
- `前端:ESLint检查` - 检查代码规范
- `前端:运行测试` - 运行前端测试
- `前端:测试覆盖率` - 生成测试覆盖率报告
- `前端:安装依赖` - 安装前端依赖
- `前端:更新依赖` - 更新前端依赖

#### 7.2 后端任务列表
- `后端:启动开发服务器` - 启动后端开发服务器
- `后端:构建项目` - 构建后端生产版本
- `后端:类型检查` - 检查TypeScript类型
- `后端:运行测试` - 运行后端测试
- `后端:安装依赖` - 安装后端依赖

#### 7.3 全栈任务列表
- `全栈:启动所有服务` - 同时启动前后端服务器
- `全栈:构建所有项目` - 同时构建前后端项目
- `全栈:类型检查` - 同时检查前后端类型
- `全栈:安装所有依赖` - 安装所有项目依赖

#### 7.4 测试任务列表
- `测试:运行所有测试` - 运行前后端所有测试
- `测试:AI服务测试` - 测试AI服务功能
- `测试:后端服务+AI测试` - 启动后端并测试AI

#### 7.5 运维任务列表
- `运维:停止所有服务` - 停止所有运行中的服务
- `运维:Docker构建` - 构建Docker镜像
- `运维:Docker启动` - 启动Docker容器
- `运维:Docker停止` - 停止Docker容器
- `运维:查看Docker日志` - 查看容器运行日志

#### 7.6 质量任务列表
- `质量:ESLint检查修复` - 检查并修复代码规范问题
- `质量:代码格式化` - 格式化前后端代码

### 8. 开发环境配置 ⚙️

#### 8.1 必需工具
- **Node.js** >= 16.0.0
- **npm** >= 8.0.0
- **TypeScript** >= 4.5.0
- **Docker** >= 20.0.0 (可选)
- **VS Code** >= 1.70.0

#### 8.2 VS Code扩展
- **TypeScript and JavaScript Language Features** (内置)
- **ESLint** - 代码规范检查
- **Prettier** - 代码格式化
- **Docker** - 容器管理
- **Thunder Client** - API测试

#### 8.3 端口分配
- **前端开发服务器**：3001
- **后端开发服务器**：3002
- **数据库服务**：27017 (MongoDB)
- **Redis服务**：6379 (可选)

### 9. 团队协作规范 👥

#### 9.1 代码提交规范
1. 提交前必须执行 `[全栈:类型检查]`
2. 提交前必须执行 `[质量:ESLint检查修复]`
3. 提交前必须执行 `[测试:运行所有测试]`
4. 提交前必须执行 `[全栈:构建所有项目]`

#### 9.2 分支管理规范
- **main分支**：生产稳定版本
- **develop分支**：开发集成分支
- **feature/**：功能开发分支
- **hotfix/**：紧急修复分支

#### 9.3 代码审查规范
- 所有代码必须通过Code Review
- 审查者必须执行相关任务验证代码质量
- 合并前必须确保所有任务通过

### 10. 故障排除指南 🚨

#### 10.1 服务启动失败
```
症状：任务执行失败，服务无法启动
排查步骤：
1. 执行 [运维:停止所有服务]
2. 检查端口占用情况
3. 执行 [前端:安装依赖] 或 [后端:安装依赖]
4. 重新执行启动任务
```

#### 10.2 类型检查失败
```
症状：TypeScript编译错误
排查步骤：
1. 执行 [前端:类型检查] 查看详细错误
2. 检查类型定义文件
3. 修复类型错误
4. 重新执行类型检查确认修复
```

#### 10.3 测试失败
```
症状：单元测试或集成测试失败
排查步骤：
1. 执行 [前端:运行测试] 查看失败原因
2. 检查测试文件和业务逻辑
3. 修复测试问题
4. 重新执行测试确认通过
```

#### 10.4 构建失败
```
症状：npm run build失败
排查步骤：
1. 执行 [前端:类型检查] 确保无类型错误
2. 执行 [质量:ESLint检查修复] 确保无规范错误
3. 检查构建配置文件
4. 重新执行构建任务
```

---

## 📝 重要提醒

**🚨 严格执行任务系统规范**
- 禁止绕过任务系统直接执行命令
- 所有操作都必须有对应的预定义任务
- 发现缺失的任务必须及时添加到tasks.json
- 保持任务定义的统一性和规范性

**⚡ 提高开发效率**
- 熟悉常用任务的快捷键
- 善用VS Code的任务历史记录
- 利用任务依赖关系自动化流程
- 定期优化和更新任务配置

**🔒 确保代码质量**
- 每次提交前必须通过所有质量检查任务
- 保持100%的TypeScript类型覆盖率
- 确保所有测试用例通过
- 遵循统一的代码规范和命名约定

**📊 持续改进**
- 定期审查和优化任务配置
- 收集团队反馈改进开发流程
- 更新工具链和最佳实践
- 完善文档和培训材料

---

**文档维护**：开发团队  
**最后更新**：2025年6月26日  
**文档版本**：v1.0  
**适用项目**：人工智能辅助实验平台全栈开发
