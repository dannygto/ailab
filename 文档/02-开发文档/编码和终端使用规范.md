# AICAM项目编码和终端使用规范

## 远程服务器配置信息

### 生产服务器
- **服务器IP**: 82.156.75.232
- **用户名**: ubuntu
- **密码**: Danny486020!!&&
- **远程路径**: /home/ubuntu/AICAMV2
- **SSH端口**: 22

### 需要开放的端口
- **22**: SSH连接
- **3000**: 前端服务
- **3002**: 后端服务
- **5000**: AI服务

### SSH免密登录配置（推荐）
为了安全和便利，建议配置SSH密钥登录：
```bash
# 生成SSH密钥对
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"

# 将公钥复制到远程服务器
ssh-copy-id ubuntu@82.156.75.232

# 配置本地SSH config文件 ~/.ssh/config
Host aicam-server
    HostName 82.156.75.232
    User ubuntu
    Port 22
    IdentityFile ~/.ssh/id_rsa
```

## 编码规范

### PowerShell脚本编码规范
1. **所有PowerShell脚本必须使用UTF-8编码（带BOM）**
   - 使用Visual Studio Code创建新文件时，确保在右下角状态栏选择"UTF-8 with BOM"
   - 对于现有文件，通过"文件 -> 另存为"并选择"UTF-8 with BOM"编码

2. **处理中文输出**
   - 所有包含中文输出的PowerShell脚本必须在开头添加以下代码：
   ```powershell
   # 设置控制台输出编码为UTF-8
   [Console]::OutputEncoding = [System.Text.Encoding]::UTF8
   ```

3. **文件写入时的编码设置**
   - 使用`Set-Content`或`Out-File`写入文件时，必须指定UTF-8编码：
   ```powershell
   # 正确的文件写入方式
   $content | Set-Content -Path $filePath -Encoding UTF8
   # 或
   $content | Out-File -FilePath $filePath -Encoding UTF8
   ```

### Batch脚本编码规范
1. **所有.bat和.cmd文件必须使用ANSI/GB2312编码**
   - 使用记事本保存时选择"ANSI"编码
   - 使用Visual Studio Code时，选择"GB2312"或"GB18030"编码

2. **Batch文件中的中文注释**
   - 批处理文件中使用`REM`而非`@echo`进行中文注释，减少编码问题

### JSON文件编码规范
1. **所有JSON文件必须使用UTF-8编码（不带BOM）**
   - 特别是tasks.json和launch.json等配置文件

## 终端使用规范

### PowerShell终端
1. **命令执行顺序**
   - 在PowerShell中，命令顺序使用分号`;`而非`&&`：
   ```powershell
   # 正确方式
   cd $folder; ./script.ps1
   
   # 错误方式（不要在PowerShell中使用）
   cd $folder && ./script.ps1
   ```

2. **路径引用**
   - 包含空格的路径必须使用引号：`"D:\My Path\file.txt"`
   - 使用反引号`` ` ``转义特殊字符，如`` `$ ``或`` `" ``

3. **变量引用**
   - 在字符串中引用变量使用`${}`: `"Current path: ${PWD}"`
   - 避免在双引号中直接使用`$`，可能导致变量解析问题

### CMD终端
1. **命令执行顺序**
   - 在CMD中使用`&&`连接命令：
   ```batch
   cd /d D:\folder && script.bat
   ```

2. **变量引用**
   - CMD中变量使用`%VAR%`形式：`echo %PATH%`
   - 在批处理文件中设置变量：`set VAR=value`

### 跨平台注意事项
1. **路径分隔符**
   - Windows使用反斜杠`\`，Linux/Mac使用正斜杠`/`
   - 在PowerShell脚本中推荐使用`Join-Path`构建路径，避免硬编码分隔符

2. **行结束符**
   - Windows文件使用CRLF(`\r\n`)
   - Linux/Mac文件使用LF(`\n`)
   - Git设置中应明确配置`core.autocrlf`

## 文件编码检查工具

```powershell
# 检查文件编码的PowerShell函数
function Get-FileEncoding {
    param (
        [Parameter(Mandatory=$true)]
        [string]$FilePath
    )
    
    $bytes = [byte[]](Get-Content -Path $FilePath -Encoding Byte -ReadCount 1 -TotalCount 4)
    
    if ($bytes[0] -eq 0xEF -and $bytes[1] -eq 0xBB -and $bytes[2] -eq 0xBF) {
        Write-Output "UTF-8 with BOM"
    }
    elseif ($bytes[0] -eq 0xFE -and $bytes[1] -eq 0xFF) {
        Write-Output "UTF-16 BE"
    }
    elseif ($bytes[0] -eq 0xFF -and $bytes[1] -eq 0xFE) {
        Write-Output "UTF-16 LE"
    }
    elseif ($bytes[0] -eq 0 -and $bytes[1] -eq 0 -and $bytes[2] -eq 0xFE -and $bytes[3] -eq 0xFF) {
        Write-Output "UTF-32 BE"
    }
    elseif ($bytes[0] -eq 0xFF -and $bytes[1] -eq 0xFE -and $bytes[2] -eq 0 -and $bytes[3] -eq 0) {
        Write-Output "UTF-32 LE"
    }
    else {
        Write-Output "UTF-8 without BOM or ASCII"
    }
}

# 使用示例
# Get-FileEncoding -FilePath "path\to\your\file.ps1"
```

## 常见问题处理

1. **执行策略问题**
   - 始终使用`-ExecutionPolicy Bypass`参数运行PowerShell脚本
   - 示例：`powershell -ExecutionPolicy Bypass -File script.ps1`

2. **中文乱码问题**
   - 检查文件编码（使用上述工具）
   - 确保终端使用UTF-8编码：`chcp 65001`
   - 确保PowerShell脚本设置了`[Console]::OutputEncoding`

3. **命令行参数问题**
   - 参数中包含空格时使用引号：`script.ps1 -path "My Path"`
   - 避免使用特殊字符，必要时转义
